---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

// 1. Fetch all articles
const allArticles = await getCollection("articles");

// 2. Sort all articles by date, newest first
allArticles.sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);

// 3. Filter and slice to get the 7 most recent of each type
const recentBlogs = allArticles
    .filter((post) => post.data.type === "blog")
    .slice(0, 7);
const recentProjects = allArticles
    .filter((post) => post.data.type === "project")
    .slice(0, 7);
---

<Layout title="Home" noBox={true}>
    <!-- About Section -->
    <div class="box">
        <p>
            Hello! Welcome to my personal space on the web. You can call me
            xzat. Currently studying phyics (electronics and semiconductor)
            somewhere in Malaysia. I have a lot of interests other than physics,
            like tennis, Japanesese language (N5, otw N3) and photography.
            <br /><br />
            Facts about me:
        </p>
        <ul>
            <li>
                Favourite anime is Attack on Titan and Takopii's Original Sin
            </li>
            <li>Favourite tennis player is Jannik Sinner</li>
            <li>Currently trying to make optical fiber temperature sensor</li>
            <li>
                Used to be a wordcel back in school, now my mind fully operate
                as shape rotator. Trying to balance both right now.
            </li>
        </ul>
    </div>

    <!-- Recent Blogs Section -->
    <div class="box">
        <h2>Recent Blog Posts</h2>
        <ul class="recent-list">
            {
                recentBlogs.map((post) => (
                    <li>
                        <a
                            href={`${import.meta.env.BASE_URL}article/${post.slug}`}
                        >
                            {post.data.title} -{" "}
                            {post.data.publishDate.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })}
                        </a>
                    </li>
                ))
            }
        </ul>
        <a href={import.meta.env.BASE_URL + "blog"} class="more-link"
            >All Posts &rarr;</a
        >
    </div>

    <!-- Recent Projects Section -->
    <div class="box">
        <h2>Recent Projects</h2>
        <ul class="recent-list">
            {
                recentProjects.map((post) => (
                    <li>
                        <a
                            href={`${import.meta.env.BASE_URL}article/${post.slug}`}
                        >
                            {post.data.title} -{" "}
                            {post.data.publishDate.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })}
                        </a>
                    </li>
                ))
            }
        </ul>
        <a href={import.meta.env.BASE_URL + "projects"} class="more-link"
            >All Projects &rarr;</a
        >
    </div>
</Layout>

<style>
    .box {
        margin-bottom: 2rem;
    }
    .box:last-child {
        margin-bottom: 0;
    }
    h2 {
        margin-top: 0;
        border-bottom: 1px solid #a9c1e8;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    .recent-list {
        list-style: none;
        padding: 0;
        margin: 0 0 1.5rem 0;
    }
    .recent-list li {
        margin-bottom: 0.5rem;
    }
    .recent-list a {
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }
    .recent-list a:hover {
        color: #fff; /* A slightly brighter color on hover */
    }
    .more-link {
        text-decoration: none;
        font-weight: bold;
    }
</style>
