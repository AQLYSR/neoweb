---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";

// 1. Fetch all articles
const allArticles = await getCollection("articles");

// 2. Sort all articles by date, newest first
allArticles.sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf(),
);

// 3. Filter and slice to get the 7 most recent of each type
const recentBlogs = allArticles
    .filter((post) => post.data.type === "blog")
    .slice(0, 7);
const recentProjects = allArticles
    .filter((post) => post.data.type === "project")
    .slice(0, 7);
---

<Layout title="Home" noBox={true}>
    <!-- About Section -->
    <div class="box">
        <h2>About Me</h2>
        <p>
            This is a short summary of who I am and what I do. You can replace
            this text with your own personal introduction. Welcome to my
            personal space on the web!
        </p>
        <a href="/about" class="more-link">Read More &rarr;</a>
    </div>

    <!-- Recent Blogs Section -->
    <div class="box">
        <h2>Recent Blog Posts</h2>
        <ul class="recent-list">
            {
                recentBlogs.map((post) => (
                    <li>
                        <a href={`/article/${post.slug}`}>
                            {post.data.title} -{" "}
                            {post.data.publishDate.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })}
                        </a>
                    </li>
                ))
            }
        </ul>
        <a href="/blog" class="more-link">All Posts &rarr;</a>
    </div>

    <!-- Recent Projects Section -->
    <div class="box">
        <h2>Recent Projects</h2>
        <ul class="recent-list">
            {
                recentProjects.map((post) => (
                    <li>
                        <a href={`/article/${post.slug}`}>
                            {post.data.title} -{" "}
                            {post.data.publishDate.toLocaleDateString("en-US", {
                                year: "numeric",
                                month: "short",
                                day: "numeric",
                            })}
                        </a>
                    </li>
                ))
            }
        </ul>
        <a href="/projects" class="more-link">All Projects &rarr;</a>
    </div>
</Layout>

<style>
    .box {
        margin-bottom: 2rem;
    }
    .box:last-child {
        margin-bottom: 0;
    }
    h2 {
        margin-top: 0;
        border-bottom: 1px solid #a9c1e8;
        padding-bottom: 0.5rem;
        margin-bottom: 1rem;
    }
    .recent-list {
        list-style: none;
        padding: 0;
        margin: 0 0 1.5rem 0;
    }
    .recent-list li {
        margin-bottom: 0.5rem;
    }
    .recent-list a {
        text-decoration: none;
        transition: color 0.2s ease-in-out;
    }
    .recent-list a:hover {
        color: #fff; /* A slightly brighter color on hover */
    }
    .more-link {
        text-decoration: none;
        font-weight: bold;
    }
</style>
